%YAML:1.0
# rosrun neural_mapping neural_mapping_node src/RIM2/rim/config/neural_rgbd/neural_rgbd.yaml src/RIM2/data/neural_rgbd_data/kitchen_kitti_format

base_config: "../base.yaml"

sdf_iter_step: 10000
sdf_end_step: 40000
iter_step: 60000

preload: 0 # 0: disable; 1: enable # accelerate the loading process but will cost more memory
llff: 1 # 0: disable; 1: enable; every 8 frame will be used for evaluation
prob_map_en: 0 # 0: disable; 1: enable; Whether the map is a probabilistic map
sh_degree: 3
bck_color: 1 # 0: black background; 1: white background; 2: discourage transparancy; degenerate results

prefilter: 15 # PSNR(SSIM) threshold; prefilter image according to sequential ssim: https://blog.csdn.net/weixin_43135178/article/details/118497369
max_time_diff_camera_and_pose: 0.025
max_time_diff_lidar_and_pose: 0.05

# dataset_type
#   Replica = 0,
#   R3live = 1,
#   NeuralRGBD = 2,
#   KITTI = 3,
#   FastLivo = 4,
#   Oxford Spires = 5,
dataset_type: 4

frame_rate: 10

min_range: 0.01
max_range: 100
ds_pt_num: 10000 # downsampled point number
max_pt_num: 5000000

# scene config
leaf_sizes: 0.4
fill_level: 1
bce_sigma: 1e-1 # if get floaters, increase this value
align_weight: 1.0 # adjust smoothness (higher smoother)

outlier_remove: 0 # unnecessary for static scenes
outlier_dist: 0.05
outlier_removal_interval: 4000

# visualization
vis_attribute: 2 # 0: disable to save storage; 1: normal; 2: color
vis_resolution: 0.1 # better no more than leaf_sizes or will miss faces
export_resolution: 0.04
fps: 10

batch_ray_num: 1e7 # 1e4 # lower it if OOM(Out of Memory)

camera:
   model: 1 # 0: pinhole; 1: equidistant
   width: 1440
   height: 1080

   fx: 698.3946772032825
   fy: 698.4629665854908
   cx: 718.431814292891
   cy: 559.7771701003702

   d0: -0.04707469981321094
   d1: 0.011515146787673071
   d2: -0.008908394423298474
   d3: 0.0018561099343051583
   d4: 0.0

extrinsic:
   # lidar to camera
   T_C_L: !!opencv-matrix
      rows: 4
      cols: 4
      dt: d
      data: [ 0.009769443369467168, 0.9999460020163569, 0.0035427429705001123,0.00035060884033447846,
        0.007671197638838445, 0.003467861351881818, -0.9999645627043141,-0.079574053851818,
        -0.9999228523756403, 0.009796274248324188, -0.007636904334543504,-0.053826061545697405,
              0.0, 0.0, 0.0, 1.0 ]

   # lidar to base(imu)
   T_B_L: !!opencv-matrix
      rows: 4
      cols: 4
      dt: d
      data: [ -1.79010935e-02, -9.99839500e-01,  7.24771588e-04,-2.98737408e-03,
                9.99839311e-01, -1.79003915e-02,  9.63774848e-04,-1.62174455e-02,
                -9.50646466e-04,  7.41907749e-04,  9.99999273e-01,8.37937008e-02,
               0.0,  0.0, 0.0, 1.0 ]

# map:
#    map_origin: !!opencv-matrix
#       rows: 1
#       cols: 3
#       dt: d
#       data: [ 34, 318, 20 ]
   
#    map_size: 300
map:
   map_origin: !!opencv-matrix
      rows: 1
      cols: 3
      dt: d
      data: [ 0, 0, 0 ]
   
   map_size: 300